---
/**
 * Services Page Schema Component
 * Generates comprehensive schema for services page including:
 * - WebPage schema
 * - BreadcrumbList
 * - Multiple Service schemas
 */
import { getCollection } from 'astro:content';
import { companyInfo } from '../../data/company-info';
import {
  generateWebPageSchema,
  generateBreadcrumbSchema,
  generateServiceSchema,
  createSchemaGraph
} from '../../utils/schema-helpers';

interface Props {
  siteUrl?: string;
  pageUrl: string;
  pageTitle: string;
  pageDescription: string;
}

const { siteUrl = companyInfo.url, pageUrl, pageTitle, pageDescription } = Astro.props;

// Get all services from content collection with error handling
let servicesEntries = [];
try {
  servicesEntries = await getCollection('services');
} catch (error) {
  console.error('Error loading services for schema:', error);
  // Fallback to empty array if collection fails to load
  servicesEntries = [];
}

// Generate individual schemas
const webPageSchema = generateWebPageSchema({
  title: pageTitle,
  description: pageDescription,
  url: pageUrl
}, siteUrl);

const breadcrumbSchema = generateBreadcrumbSchema([
  { name: 'Home', url: '/' },
  { name: 'Services', url: pageUrl }
], siteUrl);

const serviceSchemas = servicesEntries.map(service =>
  generateServiceSchema({
    name: service.data.title,
    description: service.data.description,
    features: service.data.features
  }, siteUrl)
);

// Combine all schemas into a single @graph
const schema = createSchemaGraph(
  webPageSchema,
  breadcrumbSchema,
  ...serviceSchemas
);
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
