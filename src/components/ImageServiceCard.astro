---
/**
 * ImageServiceCard Component
 * Image-backed card for displaying services with authentic project imagery
 * Used in homepage "We Can Help You" section for Arron Bennett Building
 *
 * @component
 * @example
 * <ImageServiceCard
 *   title="Full Builds"
 *   description="Complete new construction projects"
 *   image={projectImage}
 *   imageAlt="Modern Cornwall new build project"
 * />
 */

import { Image } from 'astro:assets';

interface Props {
  title: string;
  description: string;
  image: ImageMetadata;
  imageAlt?: string;
  href?: string;
}

const { title, description, image, imageAlt, href } = Astro.props;

// Generate descriptive alt text if not provided
const altText = imageAlt || `${title} - ${description} - Arron Bennett Building Cornwall`;

// Determine if card should be clickable
const Tag = href ? 'a' : 'div';
const linkProps = href ? { href } : {};
---

<article class="image-service-card">
  <Tag
    {...linkProps}
    class:list={[
      'service-card-inner',
      'relative block overflow-hidden rounded-xl',
      'shadow-lg transition-all duration-300',
      'hover:shadow-2xl hover:scale-105',
      'focus:outline-none focus:ring-4 focus:ring-coral-500 focus:ring-offset-2',
      'bg-navy-900',
      href && 'cursor-pointer'
    ]}
    aria-label={href ? `Learn more about ${title}` : title}
  >
    <!-- Image Background (Square aspect ratio) -->
    <div class="aspect-square relative">
      <Image
        src={image}
        alt={altText}
        class="w-full h-full object-cover"
        widths={[400, 600, 800]}
        sizes="(max-width: 640px) 100vw, (max-width: 768px) 50vw, (max-width: 1024px) 33vw, 400px"
        loading="lazy"
        format="avif"
      />
    </div>

    <!-- Navy Gradient Overlay with Service Title -->
    <div
      class="absolute inset-0 flex flex-col items-center justify-center p-6 transition-all duration-300 overlay-gradient"
    >
      <!-- Service Title (Always Visible) -->
      <h3 class="text-xl sm:text-2xl lg:text-2xl font-bold text-white text-center leading-tight drop-shadow-lg z-10">
        {title}
      </h3>

      <!-- Description (Shows on hover for desktop, always hidden on mobile) -->
      <p class="description-text text-white/95 text-sm sm:text-base text-center mt-4 max-w-xs leading-relaxed drop-shadow-lg">
        {description}
      </p>
    </div>

    <!-- Optional: Arrow indicator for linked cards -->
    {href && (
      <div class="arrow-indicator absolute bottom-4 right-4 w-10 h-10 bg-coral rounded-full flex items-center justify-center shadow-lg">
        <svg
          class="w-5 h-5 text-white"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2.5"
            d="M9 5l7 7-7 7"
          />
        </svg>
      </div>
    )}
  </Tag>
</article>

<style>
  /* Card container */
  .image-service-card {
    position: relative;
    width: 100%;
  }

  /* Inner card wrapper */
  .service-card-inner {
    display: block;
    position: relative;
    width: 100%;
  }

  /* Overlay gradient - starts subtle, becomes darker on hover */
  .overlay-gradient {
    background: linear-gradient(
      to bottom,
      rgba(26, 45, 77, 0.65),
      rgba(26, 45, 77, 0.75)
    );
  }

  .service-card-inner:hover .overlay-gradient {
    background: linear-gradient(
      to bottom,
      rgba(26, 45, 77, 0.75),
      rgba(26, 45, 77, 0.85)
    );
  }

  /* Description text - hidden by default, shows on hover (desktop only) */
  .description-text {
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  /* Show description on hover for desktop/tablet */
  @media (min-width: 768px) {
    .service-card-inner:hover .description-text {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* On mobile, keep description hidden to maintain clean look */
  @media (max-width: 767px) {
    .description-text {
      display: none;
    }
  }

  /* Arrow indicator - hidden by default, shows on hover */
  .arrow-indicator {
    opacity: 0;
    transform: translateX(10px);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .service-card-inner:hover .arrow-indicator {
    opacity: 1;
    transform: translateX(0);
  }

  /* Smooth scale transformation */
  .service-card-inner {
    will-change: transform, box-shadow;
  }

  /* Text shadow for better readability */
  h3 {
    text-shadow: 0 2px 12px rgba(0, 0, 0, 0.6);
  }

  /* Focus state for accessibility */
  .service-card-inner:focus-visible {
    outline: 4px solid #A83820;
    outline-offset: 4px;
    box-shadow: 0 0 0 4px rgba(168, 56, 32, 0.2);
  }

  /* Prevent layout shift during hover animations */
  .image-service-card {
    contain: layout;
  }

  /* Ensure aspect ratio is maintained */
  .aspect-square {
    aspect-ratio: 1 / 1;
  }
</style>
