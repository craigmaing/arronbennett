---
/**
 * SEO Component for Arron Bennett Building
 * Comprehensive meta tags, Open Graph, Twitter Cards, and Schema.org structured data
 *
 * @param title - Page title (will be suffixed with site name)
 * @param description - Meta description (150-160 characters recommended)
 * @param canonical - Canonical URL (defaults to current page)
 * @param ogImage - Open Graph image URL (1200x630 recommended)
 * @param ogType - Open Graph type (default: 'website')
 * @param noindex - Set to true to prevent indexing
 * @param article - Article metadata (published/modified dates)
 * @param schema - Additional schema.org structured data
 */

interface Props {
  title: string;
  description: string;
  canonical?: string;
  ogImage?: string;
  ogType?: 'website' | 'article' | 'profile';
  noindex?: boolean;
  article?: {
    publishedTime?: string;
    modifiedTime?: string;
  };
  schema?: Record<string, any>;
}

const {
  title,
  description,
  canonical,
  ogImage = '/images/og-default.jpg',
  ogType = 'website',
  noindex = false,
  article,
  schema
} = Astro.props;

// Site configuration
const siteName = 'Arron Bennett Building - Cornwall';
const siteUrl = 'https://arronbennettbuilding.co.uk';
const fullTitle = title.includes(siteName) ? title : `${title} | ${siteName}`;
const canonicalUrl = canonical || new URL(Astro.url.pathname, siteUrl).href;
const fullOgImage = ogImage.startsWith('http') ? ogImage : `${siteUrl}${ogImage}`;

// Default Organization Schema
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "@id": `${siteUrl}/#organization`,
  "name": "Arron Bennett Building Contractors",
  "url": siteUrl,
  "logo": {
    "@type": "ImageObject",
    "url": `${siteUrl}/images/logo.png`,
    "width": 180,
    "height": 107
  },
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": "+44-7773-463383",
    "contactType": "customer service",
    "email": "enquiries@arronbennettbuilding.co.uk",
    "areaServed": "GB",
    "availableLanguage": "English"
  },
  "sameAs": [
    // Add social media profiles here when available
  ]
};

// LocalBusiness Schema (Cornwall-based)
const localBusinessSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "@id": `${siteUrl}/#localbusiness`,
  "name": "Arron Bennett Building Contractors",
  "image": `${siteUrl}/images/logo.png`,
  "url": siteUrl,
  "telephone": "+44-7773-463383",
  "email": "enquiries@arronbennettbuilding.co.uk",
  "address": {
    "@type": "PostalAddress",
    "addressRegion": "Cornwall",
    "addressCountry": "GB"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "50.2660",
    "longitude": "-5.0527"
  },
  "areaServed": [
    {
      "@type": "State",
      "name": "Cornwall"
    },
    {
      "@type": "State",
      "name": "Devon"
    }
  ],
  "priceRange": "£££",
  "paymentAccepted": "Cash, Bank Transfer, Check",
  "openingHours": "Mo-Fr 08:00-18:00, Sa 08:00-14:00",
  "founder": {
    "@type": "Person",
    "name": "Arron Bennett",
    "jobTitle": "Master Builder"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "5.0",
    "reviewCount": "5"
  },
  "hasOfferCatalog": {
    "@type": "OfferCatalog",
    "name": "Building Services",
    "itemListElement": [
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Full Builds",
          "description": "Complete new construction projects"
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Home Renovations",
          "description": "Residential renovation work"
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Stone and Block Masonry",
          "description": "Traditional craftsmanship and heritage building"
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Kitchen and Bathroom Renovations",
          "description": "Interior renovation and upgrade services"
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Hard Landscaping",
          "description": "Outdoor stone and masonry work"
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Project Management",
          "description": "Full project oversight and coordination"
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Ground Source and Air Source Installations",
          "description": "Renewable energy systems installation"
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Service",
          "name": "Traditional Lime Mortars",
          "description": "Heritage building restoration techniques"
        }
      }
    ]
  }
};

// Person Schema (Arron Bennett)
const personSchema = {
  "@context": "https://schema.org",
  "@type": "Person",
  "@id": `${siteUrl}/#person`,
  "name": "Arron Bennett",
  "jobTitle": "Master Builder & Building Contractor",
  "description": "Traditional builder with 20+ years of experience specializing in stone masonry, heritage restoration, and modern construction methods in Cornwall",
  "url": siteUrl,
  "image": `${siteUrl}/images/arron-bennett.jpg`,
  "telephone": "+44-7773-463383",
  "email": "enquiries@arronbennettbuilding.co.uk",
  "worksFor": {
    "@id": `${siteUrl}/#organization`
  },
  "knowsAbout": [
    "Stone Masonry",
    "Traditional Building Methods",
    "Heritage Restoration",
    "Project Management",
    "Renewable Energy Installation",
    "Lime Mortar Techniques"
  ],
  "areaServed": {
    "@type": "State",
    "name": "Cornwall"
  }
};

// BreadcrumbList Schema (for navigation)
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": siteUrl
    }
  ]
};

// Add current page to breadcrumbs if not homepage
if (Astro.url.pathname !== '/') {
  const pathParts = Astro.url.pathname.split('/').filter(part => part);
  pathParts.forEach((part, index) => {
    breadcrumbSchema.itemListElement.push({
      "@type": "ListItem",
      "position": index + 2,
      "name": part.charAt(0).toUpperCase() + part.slice(1).replace(/-/g, ' '),
      "item": `${siteUrl}/${pathParts.slice(0, index + 1).join('/')}`
    });
  });
}

// Combine all schemas
const schemaData = [
  organizationSchema,
  localBusinessSchema,
  personSchema,
  breadcrumbSchema,
  ...(schema ? [schema] : [])
];
---

<!-- Primary Meta Tags -->
<title>{fullTitle}</title>
<meta name="title" content={fullTitle} />
<meta name="description" content={description} />
<link rel="canonical" href={canonicalUrl} />

<!-- Robots -->
{noindex ? (
  <meta name="robots" content="noindex, nofollow" />
) : (
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
)}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={ogType} />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:title" content={fullTitle} />
<meta property="og:description" content={description} />
<meta property="og:image" content={fullOgImage} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:site_name" content={siteName} />
<meta property="og:locale" content="en_GB" />

{article && article.publishedTime && (
  <meta property="article:published_time" content={article.publishedTime} />
)}
{article && article.modifiedTime && (
  <meta property="article:modified_time" content={article.modifiedTime} />
)}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonicalUrl} />
<meta name="twitter:title" content={fullTitle} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={fullOgImage} />

<!-- Additional Meta Tags -->
<meta name="author" content="Arron Bennett Building Contractors" />
<meta name="theme-color" content="#021f59" />
<meta name="msapplication-TileColor" content="#021f59" />

<!-- Geo Tags for Local SEO -->
<meta name="geo.region" content="GB-CON" />
<meta name="geo.placename" content="Cornwall" />
<meta name="geo.position" content="50.2660;-5.0527" />
<meta name="ICBM" content="50.2660, -5.0527" />

<!-- Schema.org Structured Data -->
<script type="application/ld+json" set:html={JSON.stringify(schemaData)} />

<!-- Preconnect for Performance -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- DNS Prefetch -->
<link rel="dns-prefetch" href="https://www.google-analytics.com" />
